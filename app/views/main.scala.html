@(title: String, user: models.User = null)(content: Html)

@import com.feth.play.module.pa.providers.AuthProvider._
@import com.feth.play.module.pa.views.html._

<!DOCTYPE html>
<html lang="@lang().code()">
    <head>
        <title>@title</title>
        <script src="/assets/javascripts/jquery-1.9.0.min.js" type="text/javascript"></script>
    </head>

    <body>
        @if(flash.contains(Application.FLASH_ERROR_KEY)) {
            <div style="color : red ;">
            @flash().get(Application.FLASH_ERROR_KEY)
            </div>
        }
        @if(flash.contains(Application.FLASH_MESSAGE_KEY)) {
            <div style="color : blue ;">
            @flash().get(Application.FLASH_MESSAGE_KEY)
            </div>
        }

        @currentAuth() { auth =>

            @if(auth != null && user != null) {

                Bienvenue @user.name - <a href="@com.feth.play.module.pa.controllers.routes.Authenticate.logout">
                    Logout</a>

                <ul>
                    <li><a href="@routes.Gifts.index">My Gifts</a></li>
                    <li><a href="@routes.Catalog.index">Catalog</a></li>
                    <li><a href="@routes.Requests.index">Requests</a></li>
                    <li><a href="@routes.MyRequests.index">My Requests</a></li>
                </ul>

            } else {
                @defining(Registry.get("google")) { p =>
                    Se connecter avec <a href="@p.getUrl()">@p.getKey()</a>
                }

            }
        }

        @content

        <script type="text/javascript">
            $('.want').click(function(evt) {
                $.ajax({
                    type : 'POST',
                    url : "/request",
                    data : {id: evt.currentTarget.attributes.getNamedItem('data-gift-id').value},
                    dataType : "json"
                });
                return false;
            });

            $('.give').click(function(evt) {
                var attributes = evt.currentTarget.attributes;$.ajax({
                    type : 'POST',
                    url : "/give",
                    data : {requestId: attributes.getNamedItem('data-request-id').value},
                    dataType : "json"
                });
                return false;
            });
        </script>
    </body>
</html>